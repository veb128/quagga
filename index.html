<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ZXing Camera Selector</title>
    <style>
      #video {
        width: 100%;
        max-width: 600px;
        border: 2px solid #333;
      }
      #output {
        margin-top: 20px;
        text-align: center;
        font-size: 1.2em;
      }
      #cameraSelect {
        display: block;
        margin: 10px auto;
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <h1 style="text-align: center">ZXing UPC Scanner with Selection</h1>

    <select id="cameraSelect"></select>
    <video id="video" autoplay></video>
    <div id="output">Select a camera to begin...</div>

    <!-- ZXing UMD build -->
    <script src="https://unpkg.com/@zxing/library@0.18.6/umd/index.min.js"></script>
    <script>
      const hints = new Map();
      hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, [
        ZXing.BarcodeFormat.UPC_A,
        ZXing.BarcodeFormat.UPC_E,
      ]);
      const codeReader = new ZXing.BrowserMultiFormatReader(hints);
      const videoElement = document.getElementById("video");
      const cameraSelect = document.getElementById("cameraSelect");
      const output = document.getElementById("output");

      codeReader.listVideoInputDevices().then((devices) => {
        devices.forEach((device, index) => {
          const option = document.createElement("option");
          option.value = device.deviceId;
          option.text = device.label || `Camera ${index + 1}`;
          cameraSelect.appendChild(option);
        });

        if (devices.length > 0) {
          startScanning(devices[0].deviceId);
        }
      });

      cameraSelect.addEventListener("change", () => {
        codeReader.reset();
        startScanning(cameraSelect.value);
      });

      function startScanning(deviceId) {
        output.textContent = "Scanning...";
        codeReader.decodeFromVideoDevice(
          deviceId,
          videoElement,
          (result, err) => {
            if (result) {
              output.textContent = `Scanned Code: ${result.text}`;
              codeReader.reset(); // stop scanning after successful read
            } else if (err && !(err instanceof ZXing.NotFoundException)) {
              console.error(err);
              output.textContent = `Error: ${err.message || err}`;
            }
          }
        );
      }
    </script>
  </body>
</html>
