<video id="video" autoplay></video>
<div id="output">Waiting for scan...</div>

<script>
  if ('BarcodeDetector' in window) {
    const formats = ['upc_a', 'upc_e'];
    const detector = new BarcodeDetector({ formats });

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(stream => {
        const video = document.getElementById('video');
        video.srcObject = stream;

        const scan = () => {
          detector.detect(video).then(barcodes => {
            if (barcodes.length > 0) {
              document.getElementById('output').textContent = `Scanned: ${barcodes[0].rawValue}`;
              stream.getTracks().forEach(track => track.stop());
            } else {
              requestAnimationFrame(scan);
            }
          });
        };

        requestAnimationFrame(scan);
      })
      .catch(err => {
        document.getElementById('output').textContent = `Camera error: ${err.message}`;
      });
  } else {
    document.getElementById('output').textContent = 'BarcodeDetector not supported in this browser.';
  }
</script>